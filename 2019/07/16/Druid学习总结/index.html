<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>Druid学习总结 | 明哲而痴心</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Druid 学习总结1. Druid简介Druid是一个JDBC组件，包括三部分：  DruidDriver：代理Driver，能够提供基于Filter-Chain模式的插件体系。 DruidDataSource：高效可管理的数据库连接池。 SQLParser ：sql解析器   2. Druid功能 监控数据库访问性能，Druid内置提供一个功能强大的StatFilter插件，能够详细统计SQL">
<meta property="og:type" content="article">
<meta property="og:title" content="Druid学习总结">
<meta property="og:url" content="http://yoursite.com/2019/07/16/Druid学习总结/index.html">
<meta property="og:site_name" content="明哲而痴心">
<meta property="og:description" content="Druid 学习总结1. Druid简介Druid是一个JDBC组件，包括三部分：  DruidDriver：代理Driver，能够提供基于Filter-Chain模式的插件体系。 DruidDataSource：高效可管理的数据库连接池。 SQLParser ：sql解析器   2. Druid功能 监控数据库访问性能，Druid内置提供一个功能强大的StatFilter插件，能够详细统计SQL">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-07-16T06:28:30.329Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Druid学习总结">
<meta name="twitter:description" content="Druid 学习总结1. Druid简介Druid是一个JDBC组件，包括三部分：  DruidDriver：代理Driver，能够提供基于Filter-Chain模式的插件体系。 DruidDataSource：高效可管理的数据库连接池。 SQLParser ：sql解析器   2. Druid功能 监控数据库访问性能，Druid内置提供一个功能强大的StatFilter插件，能够详细统计SQL">
  
    <link rel="alternative" href="/atom.xml" title="明哲而痴心" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">记得</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">记得</h1>
			</hgroup>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            <article id="post-Druid学习总结" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Druid学习总结
    </h1>
  

        
        <a href="/2019/07/16/Druid学习总结/" class="archive-article-date">
  	<time datetime="2019-07-16T06:28:24.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-07-16</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Druid-学习总结"><a href="#Druid-学习总结" class="headerlink" title="Druid 学习总结"></a>Druid 学习总结</h1><h2 id="1-Druid简介"><a href="#1-Druid简介" class="headerlink" title="1. Druid简介"></a>1. Druid简介</h2><p>Druid是一个JDBC组件，包括三部分：</p>
<ul>
<li>DruidDriver：代理Driver，能够提供基于Filter-Chain模式的插件体系。</li>
<li>DruidDataSource：高效可管理的数据库连接池。</li>
<li>SQLParser ：sql解析器 </li>
</ul>
<h2 id="2-Druid功能"><a href="#2-Druid功能" class="headerlink" title="2. Druid功能"></a>2. Druid功能</h2><ul>
<li>监控数据库访问性能，Druid内置提供一个功能强大的StatFilter插件，能够详细统计SQL的执行性能，利于线上分析数据库访问性能； </li>
<li>替换DBCP和C3P0。Druid提供了一个高效、功能强大、可扩展性好的数据库连接池。</li>
<li>数据库密码加密。DruidDruiver和DruidDataSource支持PasswordCallback。</li>
<li>SQL执行日志。Druid提供了不同的LogFilter，能够支持Common-Logging、Log4j和JdkLog。可以按需要选择相应的LogFilter，监控应用的数据库访问情况。 </li>
<li>扩展JDBC。若对JDBC层有编程的需求，可以通过Druid提供的Filter-Chain机制，方便的编写JDBC层的扩展插件。</li>
</ul>
<h2 id="3-Druid连接池"><a href="#3-Druid连接池" class="headerlink" title="3. Druid连接池"></a>3. Druid连接池</h2><ul>
<li>Druid连接池是阿里巴巴开源的数据库连接池项目</li>
<li>Druid连接池为监控而生，内置强大的监控功能，监控特性不影响性能。</li>
<li>能防SQL注入，内置Loging能诊断Hack应用行为。</li>
</ul>
<h2 id="4-Druid竞品分析"><a href="#4-Druid竞品分析" class="headerlink" title="4. Druid竞品分析"></a>4. Druid竞品分析</h2><div class="bi-table"><br>  <table><br>    <colgroup><br>      <col width="90px"><br>      <col width="163px"><br>      <col width="124px"><br>      <col width="110px"><br>      <col width="90px"><br>      <col width="163px"><br>      <col width="85px"><br>    </colgroup><br>    <tbody><br>      <tr height="34px"><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">功能类别</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">功能</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">Druid</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">HikariCP</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">DBCP</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">Tomcat-jdbc</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">C3P0</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="3" colspan="1"><br>          <div data-type="p">性能</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">PSCache</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">LRU</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">SLB负载均衡支持</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">稳定性</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">ExceptionSorter </div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">扩展</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">扩展</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">Filter</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p"></div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p"></div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">JdbcIntercepter</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p"></div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="3" colspan="1"><br>          <div data-type="p">监控</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">监控方式</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">jmx/log/http</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">jmx/metrics</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">jmx</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">jmx</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">jmx</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">支持SQL级监控</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">Spring/Web关联监控</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="2" colspan="1"><br>          <div data-type="p"></div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">诊断支持</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">LogFilter</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">连接泄露诊断</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">logAbandoned</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="2" colspan="1"><br>          <div data-type="p">安全</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">SQL防注入</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">无</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">无</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">无</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">无</div><br>        </td><br>      </tr><br>      <tr height="34px"><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">支持配置加密</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">是</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>        <td rowspan="1" colspan="1"><br>          <div data-type="p">否</div><br>        </td><br>      </tr><br>    </tbody><br>  </table><br></div>

<p>Druid连接池在性能、监控、诊断、安全、扩展性这些方面远远超出竞品</p>
<h3 id="4-1-性能"><a href="#4-1-性能" class="headerlink" title="4.1 性能"></a>4.1 性能</h3><h4 id="4-1-1-LRU"><a href="#4-1-1-LRU" class="headerlink" title="4.1.1 LRU"></a>4.1.1 LRU</h4><p>LRU是一个性能关键指标，特别Oracle，每个Connection对应数据库端的一个进程，如果数据库连接池遵从LRU，有助于数据库服务器优化，这是重要的指标。在测试中，Druid、DBCP、Proxool是遵守LRU的。BoneCP、C3P0则不是。BoneCP在mock环境下性能可能好，但在真实环境中则就不好了。</p>
<h4 id="4-1-2-PSCache"><a href="#4-1-2-PSCache" class="headerlink" title="4.1.2 PSCache"></a>4.1.2 PSCache</h4><p>PSCache是数据库连接池的关键指标。在Oracle中，类似SELECT NAME FROM USER WHERE ID = ?这样的SQL，启用PSCache和不启用PSCache的性能可能是相差一个数量级的。Proxool是不支持PSCache的数据库连接池，如果你使用Oracle、SQL Server、DB2、Sybase这样支持游标的数据库，那你就完全不用考虑Proxool。</p>
<h3 id="4-2-稳定性"><a href="#4-2-稳定性" class="headerlink" title="4.2 稳定性"></a>4.2 稳定性</h3><p>ExceptionSorter是一个很重要的容错特性，如果一个连接产生了一个不可恢复的错误，必须立刻从连接池中去掉，否则会连续产生大量错误。这个特性，目前只有JBossDataSource和Druid实现。Druid的实现参考自JBossDataSource，经过长期生产反馈补充。</p>
<h3 id="4-3-监控"><a href="#4-3-监控" class="headerlink" title="4.3 监控"></a>4.3 监控</h3><ul>
<li>Druid连接池最初就是为监控系统采集jdbc运行信息而生的，它内置了StatFilter 功能，能采集非常完备的连接池执行信息。</li>
<li>Druid连接池内置了能和Spring/Servlet关联监控的实现，使得监控Web应用特别方便。</li>
<li>Druid连接池内置了一个监控页面，提供了非常完备的监控信息，可以快速诊断系统的瓶颈。</li>
<li>监控不影响性能</li>
<li><p>SQL参数化合并监控</p>
<p>  实际业务中，如果SQL不是走PreparedStatement，SQL没有参数化，这时SQL需要参数化合并监控才能真实反映业务情况。如下SQL：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>  参数化后：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">id</span> = ?</span><br></pre></td></tr></table></figure>
<p>  参数化合并监控是基于SQL Parser语法解析实现的，是Druid连接池独一无二的功能。</p>
</li>
<li><p>执行次数、返回行数、更新行数和并发监控</p>
<p>  StatFilter能采集到每个SQL的执行次数、返回行数总和、更新行数总和、执行中次数和和最大并发。并发监控的统计是在SQL执行开始对计数器加一，结束后对计数器减一实现的。可以采集到每个SQL的当前并发和采集期间的最大并发。</p>
</li>
<li><p>慢查监控</p>
<p>  缺省执行耗时超过3秒的被认为是慢查，统计项中有包括每个SQL的最后发生的慢查的耗时和发生时的参数。</p>
</li>
<li><p>Exception监控</p>
<p>  如果SQL执行时抛出了Exception，SQL统计项上会Exception有最后的发生时间、堆栈和Message，根据这些信息可以很容易定位错误原因。</p>
</li>
<li><p>区间分布</p>
<p>  SQL监控项上，执行时间、读取行数、更新行数都有区间分布，将耗时分布成8个区间：</p>
<ol>
<li>0 - 1 耗时0到1毫秒的次数</li>
<li>1 - 10 耗时1到10毫秒的次数</li>
</ol>
<ul>
<li>10 - 100 耗时10到100毫秒的次数</li>
<li>100 - 1,000 耗时100到1000毫秒的次数</li>
<li>1,000 - 10,000 耗时1到10秒的次数</li>
<li>10,000 - 100,000 耗时10到100秒的次数</li>
<li>100,000 - 1,000,000 耗时100到1000秒的次数</li>
<li>1,000,000 -   耗时1000秒以上的次数</li>
</ul>
</li>
</ul>
<h3 id="4-4-诊断支持"><a href="#4-4-诊断支持" class="headerlink" title="4.4 诊断支持"></a>4.4 诊断支持</h3><p>Druid连接池内置了<a href="https://github.com/alibaba/druid/wiki/%E9%85%8D%E7%BD%AE_LogFilter" target="_blank" rel="noopener">LogFilter</a>，将Connection/Statement/ResultSet相关操作的日志输出，可以用于诊断系统问题，也可以用于Hack一个不熟悉的系统。</p>
<p>LogFilter可以输出连接申请/释放，事务提交回滚，Statement的Create/Prepare/Execute/Close，ResultSet的Open/Next/Close，通过LogFilter可以详细诊断一个系统的Jdbc行为。</p>
<p>LogFilter有Log4j、Log4j2、Slf4j、CommsLog等实现。</p>
<h3 id="4-5-防SQL注入"><a href="#4-5-防SQL注入" class="headerlink" title="4.5 防SQL注入"></a>4.5 防SQL注入</h3><p>Druid连接池内置了<a href="https://github.com/alibaba/druid/wiki/%E7%AE%80%E4%BB%8B_WallFilter" target="_blank" rel="noopener">WallFilter</a> 提供防SQL注入功能，在不影响性能的同时防御SQL注入攻击。</p>
<h4 id="4-5-1-基于语意的防SQL注入"><a href="#4-5-1-基于语意的防SQL注入" class="headerlink" title="4.5.1 基于语意的防SQL注入"></a>4.5.1 基于语意的防SQL注入</h4><p>Druid连接池内置了一个功能完备的SQL Parser，能够完整解析mysql、sql server、oracle、postgresql的语法，通过语意分析能够精确识别SQL注入攻击。</p>
<h4 id="4-5-2-极低的漏报率和误报率"><a href="#4-5-2-极低的漏报率和误报率" class="headerlink" title="4.5.2 极低的漏报率和误报率"></a>4.5.2 极低的漏报率和误报率</h4><p>基于SQL语意分析，大量应用和反馈，使得Druid的防SQL注入拥有极低的漏报率和误报率。</p>
<h4 id="4-5-3-防注入对性能影响极小"><a href="#4-5-3-防注入对性能影响极小" class="headerlink" title="4.5.3 防注入对性能影响极小"></a>4.5.3 防注入对性能影响极小</h4><p>内置参数化后的Cache、高性能手写的Parser，使得打开防SQL注入对应用的性能基本不受影响。</p>
<h2 id="5-SpringBoot-Druid"><a href="#5-SpringBoot-Druid" class="headerlink" title="5. SpringBoot+Druid"></a>5. SpringBoot+Druid</h2><h3 id="5-1-使用"><a href="#5-1-使用" class="headerlink" title="5.1 使用"></a>5.1 使用</h3><ol>
<li>在 Spring Boot 项目中加入<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```Maven</span><br></pre></td></tr></table></figure></li>
</ol>
<pre><code><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```xml</span><br><span class="line">compile &apos;com.alibaba:druid-spring-boot-starter:1.1.10&apos;</span><br></pre></td></tr></table></figure>
</code></pre><ol start="2">
<li><p>添加配置</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url= </span><br><span class="line">spring.datasource.username=</span><br><span class="line">spring.datasource.password=</span><br><span class="line"># ...其他配置（可选，不是必须的，使用内嵌数据库的话上述三项也可省略不填）</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="5-2-配置属性"><a href="#5-2-配置属性" class="headerlink" title="5.2 配置属性"></a>5.2 配置属性</h3><p>Druid Spring Boot Starter 配置属性的名称完全遵照 Druid，你可以通过 Spring Boot 配置文件来配置Druid数据库连接池和监控，如果没有配置则使用默认值。</p>
<table>
<thead>
<tr>
<th>配置</th>
<th>缺省值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td></td>
<td>配置这个属性的意义在于，如果存在多个数据源，监控的时候可以通过名字来区分开来。如果没有配置，将会生成一个名字，格式是：”DataSource-“ + System.identityHashCode(this). 另外配置此属性至少在1.0.5版本中是不起作用的，强行设置name会出错。</td>
</tr>
<tr>
<td>url</td>
<td></td>
<td>连接数据库的url，不同数据库不一样。例如：<br>mysql : jdbc:mysql://10.20.153.104:3306/druid2<br> oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto</td>
</tr>
<tr>
<td>username</td>
<td></td>
<td>连接数据库的用户名</td>
</tr>
<tr>
<td>password</td>
<td></td>
<td>连接数据库的密码。如果你不希望密码直接写在配置文件中，可以使用ConfigFilter。</td>
</tr>
<tr>
<td>driverClassName</td>
<td>根据url自动识别</td>
<td>这一项可配可不配，如果不配置druid会根据url自动识别dbType，然后选择相应的driverClassName</td>
</tr>
<tr>
<td>initialSize</td>
<td>0</td>
<td>初始化时建立物理连接的个数。初始化发生在显示调用init方法，或者第一次getConnection时</td>
</tr>
<tr>
<td>maxActive</td>
<td>8</td>
<td>最大连接池数量</td>
</tr>
<tr>
<td>maxIdle</td>
<td>8</td>
<td>已经不再使用，配置了也没效果</td>
</tr>
<tr>
<td>minIdle</td>
<td></td>
<td>最小连接池数量</td>
</tr>
<tr>
<td>maxWait</td>
<td></td>
<td>获取连接时最大等待时间，单位毫秒。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置useUnfairLock属性为true使用非公平锁。</td>
</tr>
<tr>
<td>poolPreparedStatements</td>
<td>false</td>
<td>是否缓存preparedStatement，也就是PSCache。PSCache对支持游标的数据库性能提升巨大，比如说oracle。在mysql下建议关闭。</td>
</tr>
<tr>
<td>maxPoolPreparedStatementPerConnectionSize</td>
<td>-1</td>
<td>要启用PSCache，必须配置大于0，当大于0时，poolPreparedStatements自动触发修改为true。在Druid中，不会存在Oracle下PSCache占用内存过多的问题，可以把这个数值配置大一些，比如说100</td>
</tr>
<tr>
<td>validationQuery</td>
<td></td>
<td>用来检测连接是否有效的sql，要求是一个查询语句，常用select ‘x’。如果validationQuery为null，testOnBorrow、testOnReturn、testWhileIdle都不会起作用。</td>
</tr>
<tr>
<td>validationQueryTimeout</td>
<td></td>
<td>单位：秒，检测连接是否有效的超时时间。底层调用jdbc Statement对象的void setQueryTimeout(int seconds)方法</td>
</tr>
<tr>
<td>testOnBorrow</td>
<td>true</td>
<td>申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</td>
</tr>
<tr>
<td>testOnReturn</td>
<td>false</td>
<td>归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</td>
</tr>
<tr>
<td>testWhileIdle</td>
<td>false</td>
<td>建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。</td>
</tr>
<tr>
<td>keepAlive</td>
<td>false<br>（1.0.28）</td>
<td>连接池中的minIdle数量以内的连接，空闲时间超过minEvictableIdleTimeMillis，则会执行keepAlive操作。</td>
</tr>
<tr>
<td>timeBetweenEvictionRunsMillis</td>
<td>1分钟（1.0.14）</td>
<td>有两个含义：<br>1) Destroy线程会检测连接的间隔时间，如果连接空闲时间大于等于minEvictableIdleTimeMillis则关闭物理连接。<br>2) testWhileIdle的判断依据，详细看testWhileIdle属性的说明</td>
</tr>
<tr>
<td>numTestsPerEvictionRun</td>
<td>30分钟（1.0.14）</td>
<td>不再使用，一个DruidDataSource只支持一个EvictionRun</td>
</tr>
<tr>
<td>minEvictableIdleTimeMillis</td>
<td></td>
<td>连接保持空闲而不被驱逐的最小时间</td>
</tr>
<tr>
<td>connectionInitSqls</td>
<td></td>
<td>物理连接初始化的时候执行的sql</td>
</tr>
<tr>
<td>exceptionSorter</td>
<td>根据dbType自动识别</td>
<td>当数据库抛出一些不可恢复的异常时，抛弃连接</td>
</tr>
<tr>
<td>filters</td>
<td></td>
<td>属性类型是字符串，通过别名的方式配置扩展插件，常用的插件有：<br>监控统计用的filter:stat<br>日志用的filter:log4j<br>防御sql注入的filter:wall</td>
</tr>
<tr>
<td>proxyFilters</td>
<td></td>
<td>类型是List&lt;com.alibaba.druid.filter.Filter&gt;，如果同时配置了filters和proxyFilters，是组合关系，并非替换关系</td>
</tr>
</tbody>
</table>
<ul>
<li>JDBC 配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.druid.url= # 或spring.datasource.url= </span><br><span class="line">spring.datasource.druid.username= # 或spring.datasource.username=</span><br><span class="line">spring.datasource.druid.password= # 或spring.datasource.password=</span><br><span class="line">spring.datasource.druid.driver-class-name= #或 spring.datasource.driver-class-name=</span><br></pre></td></tr></table></figure>
<ul>
<li>连接池配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.druid.initial-size=</span><br><span class="line">spring.datasource.druid.max-active=</span><br><span class="line">spring.datasource.druid.min-idle=</span><br><span class="line">spring.datasource.druid.max-wait=</span><br><span class="line">spring.datasource.druid.pool-prepared-statements=</span><br><span class="line">spring.datasource.druid.max-pool-prepared-statement-per-connection-size= </span><br><span class="line">spring.datasource.druid.max-open-prepared-statements= #和上面的等价</span><br><span class="line">spring.datasource.druid.validation-query=</span><br><span class="line">spring.datasource.druid.validation-query-timeout=</span><br><span class="line">spring.datasource.druid.test-on-borrow=</span><br><span class="line">spring.datasource.druid.test-on-return=</span><br><span class="line">spring.datasource.druid.test-while-idle=</span><br><span class="line">spring.datasource.druid.time-between-eviction-runs-millis=</span><br><span class="line">spring.datasource.druid.min-evictable-idle-time-millis=</span><br><span class="line">spring.datasource.druid.max-evictable-idle-time-millis=</span><br><span class="line">spring.datasource.druid.filters= #配置多个英文逗号分隔</span><br><span class="line">....//more</span><br></pre></td></tr></table></figure>
<ul>
<li>监控配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># WebStatFilter配置，说明请参考Druid Wiki，配置_配置WebStatFilter</span><br><span class="line">spring.datasource.druid.web-stat-filter.enabled= #是否启用StatFilter默认值false</span><br><span class="line">spring.datasource.druid.web-stat-filter.url-pattern=</span><br><span class="line">spring.datasource.druid.web-stat-filter.exclusions=</span><br><span class="line">spring.datasource.druid.web-stat-filter.session-stat-enable=</span><br><span class="line">spring.datasource.druid.web-stat-filter.session-stat-max-count=</span><br><span class="line">spring.datasource.druid.web-stat-filter.principal-session-name=</span><br><span class="line">spring.datasource.druid.web-stat-filter.principal-cookie-name=</span><br><span class="line">spring.datasource.druid.web-stat-filter.profile-enable=</span><br><span class="line"></span><br><span class="line"># StatViewServlet配置，说明请参考Druid Wiki，配置_StatViewServlet配置</span><br><span class="line">spring.datasource.druid.stat-view-servlet.enabled= #是否启用StatViewServlet（监控页面）默认值为false（考虑到安全问题默认并未启动，如需启用建议设置密码或白名单以保障安全）</span><br><span class="line">spring.datasource.druid.stat-view-servlet.url-pattern=</span><br><span class="line">spring.datasource.druid.stat-view-servlet.reset-enable=</span><br><span class="line">spring.datasource.druid.stat-view-servlet.login-username=</span><br><span class="line">spring.datasource.druid.stat-view-servlet.login-password=</span><br><span class="line">spring.datasource.druid.stat-view-servlet.allow=</span><br><span class="line">spring.datasource.druid.stat-view-servlet.deny=</span><br><span class="line"></span><br><span class="line"># Spring监控配置，说明请参考Druid Github Wiki，配置_Druid和Spring关联监控配置</span><br><span class="line">spring.datasource.druid.aop-patterns= # Spring监控AOP切入点，如x.y.z.service.*,配置多个英文逗号分隔</span><br></pre></td></tr></table></figure>
<h3 id="5-3-日志输出"><a href="#5-3-日志输出" class="headerlink" title="5.3 日志输出"></a>5.3 日志输出</h3><h4 id="5-3-1-pom-xml中springboot版本依赖"><a href="#5-3-1-pom-xml中springboot版本依赖" class="headerlink" title="5.3.1. pom.xml中springboot版本依赖"></a>5.3.1. pom.xml中springboot版本依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--Spring-boot中去掉logback的依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">	&lt;exclusions&gt;</span><br><span class="line">		&lt;exclusion&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;</span><br><span class="line">		&lt;/exclusion&gt;</span><br><span class="line">	&lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--日志--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--数据库连接池--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;1.1.6&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--其他依赖--&gt;</span><br></pre></td></tr></table></figure>
<h4 id="5-3-2-log4j2-xml文件中的日志配置"><a href="#5-3-2-log4j2-xml文件中的日志配置" class="headerlink" title="5.3.2. log4j2.xml文件中的日志配置"></a>5.3.2. log4j2.xml文件中的日志配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration status=&quot;OFF&quot;&gt;</span><br><span class="line">    &lt;appenders&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;</span><br><span class="line">            &lt;!--只接受程序中DEBUG级别的日志进行处理--&gt;</span><br><span class="line">            &lt;ThresholdFilter level=&quot;DEBUG&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;[%d&#123;HH:mm:ss.SSS&#125;] %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">        &lt;/Console&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--处理DEBUG级别的日志，并把该日志放到logs/debug.log文件中--&gt;</span><br><span class="line">        &lt;!--打印出DEBUG级别日志，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档--&gt;</span><br><span class="line">        &lt;RollingFile name=&quot;RollingFileDebug&quot; fileName=&quot;./logs/debug.log&quot;</span><br><span class="line">                     filePattern=&quot;logs/$$&#123;date:yyyy-MM&#125;/debug-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;&gt;</span><br><span class="line">            &lt;Filters&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;DEBUG&quot;/&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;INFO&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;</span><br><span class="line">            &lt;/Filters&gt;</span><br><span class="line">            &lt;PatternLayout</span><br><span class="line">                    pattern=&quot;[%d&#123;yyyy-MM-dd HH:mm:ss&#125;] %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=&quot;500 MB&quot;/&gt;</span><br><span class="line">                &lt;TimeBasedTriggeringPolicy/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line">        &lt;/RollingFile&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--处理INFO级别的日志，并把该日志放到logs/info.log文件中--&gt;</span><br><span class="line">        &lt;RollingFile name=&quot;RollingFileInfo&quot; fileName=&quot;./logs/info.log&quot;</span><br><span class="line">                     filePattern=&quot;logs/$$&#123;date:yyyy-MM&#125;/info-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;&gt;</span><br><span class="line">            &lt;Filters&gt;</span><br><span class="line">                &lt;!--只接受INFO级别的日志，其余的全部拒绝处理--&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;INFO&quot;/&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;WARN&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;</span><br><span class="line">            &lt;/Filters&gt;</span><br><span class="line">            &lt;PatternLayout</span><br><span class="line">                    pattern=&quot;[%d&#123;yyyy-MM-dd HH:mm:ss&#125;] %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=&quot;500 MB&quot;/&gt;</span><br><span class="line">                &lt;TimeBasedTriggeringPolicy/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line">        &lt;/RollingFile&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--处理WARN级别的日志，并把该日志放到logs/warn.log文件中--&gt;</span><br><span class="line">        &lt;RollingFile name=&quot;RollingFileWarn&quot; fileName=&quot;./logs/warn.log&quot;</span><br><span class="line">                     filePattern=&quot;logs/$$&#123;date:yyyy-MM&#125;/warn-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;&gt;</span><br><span class="line">            &lt;Filters&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;WARN&quot;/&gt;</span><br><span class="line">                &lt;ThresholdFilter level=&quot;ERROR&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;</span><br><span class="line">            &lt;/Filters&gt;</span><br><span class="line">            &lt;PatternLayout</span><br><span class="line">                    pattern=&quot;[%d&#123;yyyy-MM-dd HH:mm:ss&#125;] %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=&quot;500 MB&quot;/&gt;</span><br><span class="line">                &lt;TimeBasedTriggeringPolicy/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line">        &lt;/RollingFile&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--处理error级别的日志，并把该日志放到logs/error.log文件中--&gt;</span><br><span class="line">        &lt;RollingFile name=&quot;RollingFileError&quot; fileName=&quot;./logs/error.log&quot;</span><br><span class="line">                     filePattern=&quot;logs/$$&#123;date:yyyy-MM&#125;/error-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;&gt;</span><br><span class="line">            &lt;ThresholdFilter level=&quot;ERROR&quot;/&gt;</span><br><span class="line">            &lt;PatternLayout</span><br><span class="line">                    pattern=&quot;[%d&#123;yyyy-MM-dd HH:mm:ss&#125;] %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=&quot;500 MB&quot;/&gt;</span><br><span class="line">                &lt;TimeBasedTriggeringPolicy/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line">        &lt;/RollingFile&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--druid的日志记录追加器--&gt;</span><br><span class="line">        &lt;RollingFile name=&quot;druidSqlRollingFile&quot; fileName=&quot;./logs/druid-sql.log&quot;</span><br><span class="line">                     filePattern=&quot;logs/$$&#123;date:yyyy-MM&#125;/api-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;[%d&#123;yyyy-MM-dd HH:mm:ss&#125;] %-5level %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">            &lt;Policies&gt;</span><br><span class="line">                &lt;SizeBasedTriggeringPolicy size=&quot;500 MB&quot;/&gt;</span><br><span class="line">                &lt;TimeBasedTriggeringPolicy/&gt;</span><br><span class="line">            &lt;/Policies&gt;</span><br><span class="line">        &lt;/RollingFile&gt;</span><br><span class="line">    &lt;/appenders&gt;</span><br><span class="line"></span><br><span class="line">    &lt;loggers&gt;</span><br><span class="line">        &lt;root level=&quot;DEBUG&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;Console&quot;/&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;RollingFileInfo&quot;/&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;RollingFileWarn&quot;/&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;RollingFileError&quot;/&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;RollingFileDebug&quot;/&gt;</span><br><span class="line">        &lt;/root&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--记录druid-sql的记录--&gt;</span><br><span class="line">        &lt;logger name=&quot;druid.sql.Statement&quot; level=&quot;debug&quot; additivity=&quot;false&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;druidSqlRollingFile&quot;/&gt;</span><br><span class="line">        &lt;/logger&gt;</span><br><span class="line">        &lt;logger name=&quot;druid.sql.Statement&quot; level=&quot;debug&quot; additivity=&quot;false&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;druidSqlRollingFile&quot;/&gt;</span><br><span class="line">        &lt;/logger&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--log4j2 自带过滤日志--&gt;</span><br><span class="line">        &lt;Logger name=&quot;org.apache.catalina.startup.DigesterFactory&quot; level=&quot;error&quot; /&gt;</span><br><span class="line">        &lt;Logger name=&quot;org.apache.catalina.util.LifecycleBase&quot; level=&quot;error&quot; /&gt;</span><br><span class="line">        &lt;Logger name=&quot;org.apache.coyote.http11.Http11NioProtocol&quot; level=&quot;warn&quot; /&gt;</span><br><span class="line">        &lt;logger name=&quot;org.apache.sshd.common.util.SecurityUtils&quot; level=&quot;warn&quot;/&gt;</span><br><span class="line">        &lt;Logger name=&quot;org.apache.tomcat.util.net.NioSelectorPool&quot; level=&quot;warn&quot; /&gt;</span><br><span class="line">        &lt;Logger name=&quot;org.crsh.plugin&quot; level=&quot;warn&quot; /&gt;</span><br><span class="line">        &lt;logger name=&quot;org.crsh.ssh&quot; level=&quot;warn&quot;/&gt;</span><br><span class="line">        &lt;Logger name=&quot;org.eclipse.jetty.util.component.AbstractLifeCycle&quot; level=&quot;error&quot; /&gt;</span><br><span class="line">        &lt;Logger name=&quot;org.hibernate.validator.internal.util.Version&quot; level=&quot;warn&quot; /&gt;</span><br><span class="line">        &lt;logger name=&quot;org.springframework.boot.actuate.autoconfigure.CrshAutoConfiguration&quot; level=&quot;warn&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;org.springframework.boot.actuate.endpoint.jmx&quot; level=&quot;warn&quot;/&gt;</span><br><span class="line">        &lt;logger name=&quot;org.thymeleaf&quot; level=&quot;warn&quot;/&gt;</span><br><span class="line">    &lt;/loggers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<h4 id="5-3-3-配置application-properties"><a href="#5-3-3-配置application-properties" class="headerlink" title="5.3.3. 配置application.properties"></a>5.3.3. 配置application.properties</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 配置日志输出</span><br><span class="line">spring.datasource.druid.filter.slf4j.enabled=true</span><br><span class="line">spring.datasource.druid.filter.slf4j.statement-create-after-log-enabled=false</span><br><span class="line">spring.datasource.druid.filter.slf4j.statement-close-after-log-enabled=false</span><br><span class="line">spring.datasource.druid.filter.slf4j.result-set-open-after-log-enabled=false</span><br><span class="line">spring.datasource.druid.filter.slf4j.result-set-close-after-log-enabled=false</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/alibaba/druid" target="_blank" rel="noopener">参考文献: github/druid</a></p>

      

      
        <div class="page-reward">
          <a href="javascript:;" class="page-reward-btn tooltip-top">
            <div class="tooltip tooltip-east">
            <span class="tooltip-item">
              赏
            </span>
            <span class="tooltip-content">
              <span class="tooltip-text">
                <span class="tooltip-inner">
                  <p class="reward-p"><i class="icon icon-quo-left"></i>谢谢你请我吃糖果<i class="icon icon-quo-right"></i></p>
                  <div class="reward-box">
                    
                    
                  </div>
                </span>
              </span>
            </span>
          </div>
          </a>
        </div>
      
    </div>
    <div class="article-info article-info-index">
      
      
      

      

      
        
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//pan.baidu.com/share/qrcode?url=http://yoursite.com/2019/07/16/Druid学习总结/" alt="微信分享二维码">
    </div>
</div>

<div class="mask js-mask"></div>
      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2019/07/16/Kubernetes-Scheduler工作原理与运行机制/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          Kubernetes Scheduler工作原理与运行机制
        
      </div>
    </a>
  
  
    <a href="/2019/07/11/达梦数据库网络管理工具-Dem工具部署/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">达梦数据库网络管理工具-Dem工具部署</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>


<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>



  
  
  

  

  

  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2019 记得
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>




    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>